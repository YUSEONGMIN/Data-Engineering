### [전체 목차](../../README.md)
### [이전 페이지](../README.md)

# 13 일차

데이터 정렬 집계

## 목차

- [정렬](#정렬)
- [기술통계 메소드](#기술통계-메소드)
- [aggregate](#aggregate)
- [Groupby](#groupby)
    - 복수열 기준 그룹핑
- [pivot_table](#pivot_table)
- [apply](#apply)
- [cut](#cut)


## [정렬](#목차)
- index 이름, column 이름을 기준으로 정렬
- `sort_index(axis=0, ascending=True, inplace=False)`

- 특정 컬럼(열)의 값을 기준으로 정렬
- `sort_values(by, ascending, inplace)`

## [기술통계 메소드](#목차)

|함수|설명|
|-|-|
|**sum()**|합계|
|**mean()**|평균|
|**median()**|중위수|
|**mode()**|최빈값|
|**quantile()**|분위수|
|**std()**|표준편차|
|**var()**|분산|
|**count()**|결측치를 제외한 원소 개수|
|**min()**|최소값|
|**max()**|최대값|
|**idxmax()**|최대값 index|
|**idxmin()**|최소값 index|
|**unique()**|고유값|
|**nunique()**|고유값의 개수|

- value_counts()는 Series에만 사용할 수 있다.
- **컬럼별로 계산한다.**
- sum(), mode(), max(), min(), unique(), nunique(), count()는 **문자열에 적용가능하다.**
- idxmax(), idxmin()는 문자열 컬럼에 사용할 수 없다.
- **공통 매개변수**
    - skipna=True(기본값)
        - 결측치(NA)를 포함해서 계산할지 여부 설정.
    - axis
        - DataFrame에 적용할 때 계산방향을 설정

## [aggregate](#목차)
- `aggregate(func, axis=0, \*args, \*\*kwargs)`

- **집계결과를 다양한 형태로 묶어서 볼 때** 사용한다.
    - **사용자 정의 집계메소드를 사용할 때도 편리하다.**
- **매개변수**
    - func 
        - 집계 함수 지정
            - 함수명/함수리스트 (문자열)
            - Dictionary : {'집계할컬럼' : 집계함수, ... }
    - axis
    - \*args, \*\*kwargs 
        - 집계함수는 첫번째 매개변수로 Series를 받는다. 그 이외의 매개변수가 있는 경우.

```py
# 도착지연시간 -> 최소, 최대
df['ARR_DELAY'].aggregate(["min", "max"]) # 문자열로 이름만 전달

> min     -60.0
> max    1185.0
> Name: ARR_DELAY, dtype: float64
```

```py
# 컬럼별로 다른 집계
func = {
    "DEP_DELAY":"mean",
    "AIR_TIME":["min","max"],
    "AIRLINE":"mode"
}
# key: 컬럼명, value: 통계량 구하는 메소드
df.agg(func)

"""
      DEP_DELAY AIR_TIME AIRLINE
      DEP_DELAY AIR_TIME    mode
mean  10.921192      NaN     NaN
min         NaN      8.0     NaN
max         NaN    577.0     NaN
0           NaN      NaN      DL
"""
```

```py
# 사용자 정의 집계함수 적용
def min_max_diff(column):
    return column.max() - column.min()

df[['AIR_TIME','DEP_DELAY']].agg(min_max_diff)    

> AIR_TIME      569.0
> DEP_DELAY    1218.0
> dtype: float64
```

## [Groupby](#목차)
- 특정 열을 기준으로 같은 값을 가지는 행끼리 묶어서 group화 한다.
    - Group으로 묶을 기준 열은 범주형 타입(category)을 사용한다.
- **구문**
    - `DF.groupby('그룹으로 묶을 기준 컬럼')`  
        - `DataFrameGroupby객체['집계할 컬럼'].집계함수()`

```py
dfgb = df.groupby('AIRLINE')
dfgb.mean(numeric_only=True)

"""
            MONTH        DAY   WEEKDAY    SCHED_DEP  DEP_DELAY    AIR_TIME  \
AIRLINE                                                                      
AA       6.661461  15.570562  3.986966  1340.140449  11.274057  144.259404   
AS       6.197917  15.247396  3.941406  1418.269531   1.808594  147.845052   
...
"""
```

```py
# AIRLINE 별 출발/도착지연 시간 (DEP_DELAY, ARR_DELAY)의 평균
df.groupby('AIRLINE')[['DEP_DELAY','ARR_DELAY']].mean()

"""
    DEP_DELAY	ARR_DELAY
AIRLINE		
AA	11.274057	5.542661
AS	1.808594	-0.833333
B6	14.287823	8.692593
...
"""
```

###  복수열 기준 그룹핑
- 두개 이상의 열을 그룹으로 묶을 수 있다. 

```py
df.groupby(['ORG_AIR','DEST_AIR'])['DEP_DELAY'].mean()

"""
ORG_AIR  DEST_AIR
ATL      ABE          9.612903
         ABQ          7.062500
         ABY         22.473684
         ACY          7.166667
         AEX         11.000000
                       ...    
SFO      SNA          8.483051
         STL         25.100000
         SUN         17.700000
         TUS         14.200000
         XNA         -3.000000
Name: DEP_DELAY, Length: 1130, dtype: float64
"""
```

```py
# groupby + agg
df.groupby('AIRLINE')['DEP_DELAY'].agg(['min','max',min_max_diff])

"""
min	max	min_max_diff
AIRLINE			
AA	-15.0	835.0	850.0
AS	-22.0	338.0	360.0
B6	-19.0	348.0	367.0
...
"""
```

## [pivot_table](#목차)

- 분류별 집계를 처리하는 함수
- group으로 묶고자 하는 컬럼들을 행과 열로 위치시키고 집계값을 값으로 보여준다.    

> pivot() 은 index와 column의 형태를 바꾸는 reshape 함수.

```
DataFrame.pivot_table(
    values=None, index=None, columns=None,
    aggfunc='mean', fill_value=None, 
    margins=False, dropna=True, margins_name='All')
```

- **매개변수**
   - **margins/margins_name**
        - margin: boolean(기본: False). 총집계결과를 만들지 여부.
        - margin_name: margin의 이름 문자열로 지정 (생략시 All)

```py
df.groupby(['AIRLINE','ORG_AIR'])['CANCELLED'].sum()

"""
AIRLINE  ORG_AIR
AA       ATL         3
         DEN         4
                    ..
WN       LAS         7
         SFO        25
"""
```

```py
df.pivot_table(index='AIRLINE', # groupby 대상 중 index(행)에 위치시킬 컬럼
               columns='ORG_AIR', # groupby 대상 중 column(열)에 위치시킬 컬럼
               values='CANCELLED', # 집계대상 컬럼
               aggfunc='sum', # 집계함수 (default: "mean")
               margins=True, # 행/열별 + 총 집계
               margins_name="총계", # margin 행/열의 이름 (default: all)
               # fill_value=0 # na를 대신할 값
              )

"""
ORG_AIR   ATL   DEN    DFW   IAH   LAS   LAX   MSP    ORD   PHX   SFO   총계
AIRLINE                                                                   
AA        3.0   4.0   86.0   3.0   3.0  11.0   3.0   35.0   4.0   2.0  154
AS        0.0   0.0    0.0   0.0   0.0   0.0   0.0    0.0   0.0   0.0    0
...
VX        NaN   NaN    NaN   NaN   0.0   3.0   NaN    0.0   NaN   3.0    6
WN        9.0  13.0    NaN   NaN   7.0  32.0   1.0    NaN   6.0  25.0   93
총계       69.0  61.0  187.0  74.0  17.0  70.0  24.0  259.0  32.0  88.0  881
"""
```

## [apply](#목차) 
- Series, DataFrame의 데이터 일괄 처리
- DataFrame.apply(함수, axis=0, args=(), \*\*kwarg)
    - **args**: 함수에 행/열 이외에 전달할 매개변수를 위치기반(순서대로) 튜플로 전달
    - **\*\*kwarg**: 함수에 행/열 이외에 전달할 매개변수를 키워드 인자로 전달
- Series.apply(함수, args=(), \*\*kwarg)

```py
"""
    C1	C2	C3	C4
0	0	1	2	3
1	4	5	6	7
2	8	9	10	11
3	12	13	14	15
4	16	17	18	19
5	20	21	22	23
"""

def func1(value):
    print(value)
    return value + 10

func1(df['C1'])
"""
0    10
1    14
2    18
3    22
4    26
5    30
"""

df['C1'].apply(func1)
"""
0    10
1    14
2    18
3    22
4    26
5    30
"""

# dataframe.apply()에 전달할 함수
def func3(series:"하나의 행/열"):
    return series + 100

df.apply(func3)    
"""
    C1	C2	C3	C4
0	100	101	102	103
1	104	105	106	107
2	108	109	110	111
3	112	113	114	115
4	116	117	118	119
5	120	121	122	123
"""
```

## [cut](#목차) 
- 연속형(실수)을 범주형으로 변환
- `pd.cut(x, bins,right=True, labels=None)`
- 매개변수
    - **x**: 범주형으로 바꿀 대상. 1차원 배열 형태의 자료구조
    - **bins**: 범주로 나눌때의 기준값(구간경계)들을 리스트로 묶어서 전달한다.
    - **right**: 구간경계의 오른쪽(True-기본)을 포함할지 왼쪽(False)을 포함할지
    - **labels**: 각 구간(범주)의 label을 리스트로 전달

```py
"""
    age	tall
0	49	189.41
1	35	155.81
2	38	173.66
3	50	172.96
...
"""

a = pd.cut(df['age'], # 범주형으로 만들 대상
       bins=3, # 정수: n(3)등분 (최소 ~ 최대)
       right=False,
       labels=["소","중","대"] # (): opened (불포함),[]: closed (포함)
      ) 

"""
0     중
1     중
2     중
3     중
...
"""
```

### [목차로 돌아가기](#목차)
## [이전 페이지](../README.md)

